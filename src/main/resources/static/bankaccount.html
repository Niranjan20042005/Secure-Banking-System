<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Secure Bank Account</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins}

body{
background:black;
color:#00ffcc;
min-height:100vh;
display:flex;
justify-content:center;
align-items:center;
}

.container{
width:500px;
max-width:95%;
background:rgba(0,0,0,0.9);
border:1px solid #00ffcc;
padding:30px;
border-radius:20px;
box-shadow:0 0 40px #00ffcc44;
}

h2{text-align:center;margin-bottom:20px}

.input-box{position:relative;margin-bottom:15px}

.input-box i{
position:absolute;
left:10px;
top:13px;
color:#00ffcc;
}

input,select{
width:100%;
padding:12px 12px 12px 35px;
border:none;
border-radius:8px;
background:#111;
color:#00ffcc;
}

button{
margin-top:12px;
width:100%;
padding:14px;
background:#00ffcc;
border:none;
border-radius:10px;
font-size:17px;
cursor:pointer;
font-weight:bold;
}

button:hover{background:#00ccaa}

.msg{
margin-top:15px;
padding:15px;
background:#001a18;
border-left:4px solid #00ffcc;
display:none;
border-radius:8px;
font-size:15px;
}

.details{
margin-top:20px;
display:none;
padding:20px;
border:1px solid #00ffcc;
border-radius:15px;
}

.card{
margin-top:20px;
height:200px;
border-radius:20px;
padding:20px;
background:linear-gradient(45deg,#000428,#004e92);
color:white;
display:none;
box-shadow:0 0 30px #00ffcc;
}

.card-number{
font-size:22px;
letter-spacing:3px;
margin-top:30px;
}

.otpBox{display:none;margin-top:15px}

.backBtn{
background:transparent;
border:1px solid #00ffcc;
color:#00ffcc;
}
</style>
</head>

<body>

<div class="container">

<h2><i class="bi bi-shield-lock-fill"></i> Create Bank Account</h2>

<div class="input-box">
<i class="bi bi-person-fill"></i>
<input type="text" id="name" placeholder="Full Name">
</div>

<div class="input-box">
<i class="bi bi-envelope-fill"></i>
<input type="email" id="email" placeholder="Email (OTP will come)">
</div>

<div class="input-box">
<i class="bi bi-bank"></i>
<select id="type">
<option value="">Select Account Type</option>
<option>Savings</option>
<option>Current</option>
<option>Student</option>
</select>
</div>

<div class="input-box">
<i class="bi bi-cash-stack"></i>
<input type="number" id="deposit" placeholder="Deposit â‚¹">
</div>

<button onclick="sendOTP()">
<i class="bi bi-envelope-check"></i> Send OTP to Gmail
</button>

<button class="backBtn" onclick="goDash()">
<i class="bi bi-arrow-left"></i> Back
</button>

<div class="otpBox" id="otpBox">
<input type="text" id="otp" placeholder="Enter Gmail OTP">
<button onclick="verifyOTP()">Verify OTP & Create Account</button>
</div>

<div class="msg" id="msg"></div>
<div class="details" id="details"></div>

<div class="card" id="card">
<b><i class="bi bi-bank2"></i> SECURE BANK</b>
<div class="card-number" id="cardNo"></div>
<div id="holder"></div>
</div>

</div>

<script>

// back
function goDash(){
window.location="customeraccount.html";
}

// SEND OTP
function sendOTP(){
let email=emailVal();
let name=nameVal();
let type=typeVal();
let dep=depVal();

if(!name||!email||!type||!dep){
showMsg('<i class="bi bi-exclamation-triangle-fill"></i> Fill all details first');
return;
}

// ðŸ”µ SHOW SENDING MESSAGE
showMsg('<i class="bi bi-arrow-repeat spin"></i> Sending OTP to Gmail...');

fetch("http://localhost:8080/bank/sendOtp/"+email)
.then(r=>r.text())
.then(()=>{
showMsg('<i class="bi bi-envelope-check-fill"></i> OTP sent successfully to Gmail');
document.getElementById("otpBox").style.display="block";
})
.catch(()=>{
showMsg('<i class="bi bi-x-circle-fill"></i> Spring Boot not running / Gmail error');
});
}

// VERIFY OTP
function verifyOTP(){
let email=emailVal();
let otp=document.getElementById("otp").value;

showMsg('<i class="bi bi-shield-lock-fill"></i> Verifying OTP...');

fetch(`http://localhost:8080/bank/verifyOtp/${email}/${otp}`)
.then(r=>r.text())
.then(d=>{
if(d.trim()=="VERIFIED"){
showMsg('<i class="bi bi-check-circle-fill"></i> OTP Verified Successfully');
createAccount();
}else{
showMsg('<i class="bi bi-x-circle-fill"></i> Wrong OTP');
}
})
.catch(()=>showMsg('<i class="bi bi-server"></i> Server error'));
}

// CREATE ACCOUNT
function createAccount(){

let name=nameVal();
let email=emailVal();
let type=typeVal();
let deposit=parseFloat(depVal());

// min balance
let min=type==="Savings"?1000:type==="Current"?5000:0;
if(deposit<min){showMsg('<i class="bi bi-cash"></i> Minimum balance â‚¹'+min);return;}

// bonus
let bonus= type==="Savings"?500:type==="Student"?300:0;
let total=deposit+bonus;

// 10 digit account
let accNo=Math.floor(1000000000 + Math.random()*9000000000);
let ifsc="SBIN0001234";

fetch("http://localhost:8080/bank/createAccount",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
name:name,
email:email,
type:type,
balance:total,
accountNo:accNo,
ifsc:ifsc
})
})
.then(res=>res.json())
.then(data=>{

showMsg('<i class="bi bi-stars"></i> Account Created Successfully');

let account=data.accountNo || accNo;
let cust=data.customerId || "CUST"+Math.floor(Math.random()*99999);
let bankIfsc=data.ifsc || ifsc;

let html=`
<h3>Account Details</h3>
Name: ${name}<br>
Email: ${email}<br>
Account: ${account}<br>
IFSC: ${bankIfsc}<br>
Customer ID: ${cust}<br>
Type: ${type}<br>
Balance: â‚¹${total}
`;

document.getElementById("details").style.display="block";
document.getElementById("details").innerHTML=html;

// ATM CARD
document.getElementById("card").style.display="block";
document.getElementById("cardNo").innerText=account;
document.getElementById("holder").innerText=name.toUpperCase();

})
.catch(()=>showMsg('<i class="bi bi-x-circle-fill"></i> Backend error'));
}

function showMsg(t){
let m=document.getElementById("msg");
m.style.display="block";
m.innerHTML=t;
}

function nameVal(){return document.getElementById("name").value.trim();}
function emailVal(){return document.getElementById("email").value.trim();}
function typeVal(){return document.getElementById("type").value;}
function depVal(){return document.getElementById("deposit").value;}

</script>
</body>
</html>




