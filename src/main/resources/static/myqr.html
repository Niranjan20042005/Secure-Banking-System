<!DOCTYPE html>
<html>
<head>
<title>My Payment QR</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins}

body{
background:linear-gradient(135deg,#020617,#0f172a,#020617);
color:white;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
}

.card{
background:rgba(255,255,255,0.05);
padding:35px;
border-radius:20px;
width:420px;
text-align:center;
border:1px solid cyan;
box-shadow:0 0 40px rgba(0,255,255,0.3);
backdrop-filter:blur(12px);
position:relative;
}

h2{margin-bottom:20px;color:cyan;text-shadow:0 0 15px cyan;}

.input-box{position:relative;margin:12px 0;}
.input-box i{position:absolute;left:12px;top:13px;color:cyan;}

.input-box input{
width:100%;padding:12px 12px 12px 38px;border:none;border-radius:10px;
outline:none;font-size:15px;background:#020617;color:white;
border:1px solid #00e5ff55;
}

button{
width:100%;padding:12px;margin-top:12px;border:none;border-radius:12px;
font-weight:600;background:linear-gradient(45deg,cyan,#00e5ff);
cursor:pointer;box-shadow:0 0 15px cyan;font-size:15px;
transition:0.3s;
}
button:hover{transform:scale(1.05)}

#qrcode{margin-top:20px;display:flex;justify-content:center;}

.msg{
margin-top:15px;font-weight:600;display:none;padding:12px;border-radius:10px;
}
.success{background:#022c22;color:#00ffcc;border:1px solid #00ffcc;}
.error{background:#3b0000;color:#ff4d4d;border:1px solid red;}

.download{
background:#16a34a;
margin-top:10px;
display:none;
}

/* back button below */
.back-btn2{
width:100%;
margin-top:10px;
padding:12px;
background:transparent;
border:1px solid cyan;
color:cyan;
border-radius:12px;
cursor:pointer;
font-weight:600;
box-shadow:0 0 10px cyan;
transition:0.3s;
}
.back-btn2:hover{
background:cyan;
color:black;
transform:scale(1.05);
}

/* spinning icon */
.spin{
animation:spin 1s linear infinite;
display:inline-block;
}
@keyframes spin{
from{transform:rotate(0deg);}
to{transform:rotate(360deg);}
}
</style>
</head>

<body>

<div class="card">

<h2><i class="bi bi-qr-code"></i> My Payment QR</h2>

<div class="input-box">
<i class="bi bi-person"></i>
<input type="text" id="name" placeholder="Enter Name">
</div>

<div class="input-box">
<i class="bi bi-bank"></i>
<input type="text" id="account" placeholder="Account Number">
</div>

<div class="input-box">
<i class="bi bi-upc-scan"></i>
<input type="text" id="ifsc" placeholder="IFSC Code">
</div>

<button onclick="sendOTP()" id="sendBtn">
<i class="bi bi-envelope-fill"></i> Send OTP to Mail
</button>

<button class="back-btn2" onclick="goBack()">
<i class="bi bi-arrow-left-circle"></i> Back to Dashboard
</button>

<div id="otpBox" style="display:none;">
<div class="input-box">
<i class="bi bi-key-fill"></i>
<input type="text" id="otp" placeholder="Enter OTP">
</div>

<button onclick="verifyOTP()">
<i class="bi bi-shield-check"></i> Verify & Generate QR
</button>
</div>

<div class="msg" id="msg"></div>
<div id="qrcode"></div>

<button class="download" id="downloadBtn" onclick="downloadQR()">
<i class="bi bi-download"></i> Download QR
</button>

</div>

<script>
let accountGlobal="";

function showMsg(text,type){
let msg=document.getElementById("msg");
msg.style.display="block";
msg.className="msg "+type;
msg.innerHTML=text;
}

function goBack(){
window.location.href="dashboard.html"; // change if needed
}

function sendOTP(){

let name=document.getElementById("name").value;
let acc=document.getElementById("account").value;
let ifsc=document.getElementById("ifsc").value;

if(!name || !acc || !ifsc){
showMsg('<i class="bi bi-exclamation-triangle-fill"></i> Enter all details',"error");
return;
}

accountGlobal = acc;

// sending animation
showMsg('<i class="bi bi-arrow-repeat spin"></i> Sending OTP to mail...', "success");

fetch(`http://localhost:8080/bank/send-qr-otp?account=${acc}`,{
method:"POST"
})
.then(res=>res.text())
.then(data=>{

if(data.includes("OTP SENT")){
showMsg('<i class="bi bi-envelope-check-fill"></i> OTP sent successfully to email',"success");
document.getElementById("otpBox").style.display="block";
}else{
showMsg('<i class="bi bi-x-circle-fill"></i> '+data,"error");
}

})
.catch(()=>{
showMsg('<i class="bi bi-wifi-off"></i> Server error',"error");
});
}

function verifyOTP(){

let otp=document.getElementById("otp").value;

fetch(`http://localhost:8080/bank/verify-qr-otp?account=${accountGlobal}&otp=${otp}`,{
method:"POST"
})
.then(res=>res.text())
.then(data=>{

if(data.includes("Verified")){
showMsg('<i class="bi bi-shield-check"></i> OTP Verified & QR Generated',"success");
generateQR();
}else{
showMsg('<i class="bi bi-x-octagon-fill"></i> '+data,"error");
}

});
}

function generateQR(){

let acc=document.getElementById("account").value;
let data=`ACCOUNT:${acc}`;

document.getElementById("qrcode").innerHTML="";

new QRCode(document.getElementById("qrcode"),{
text:data,
width:230,
height:230
});

document.getElementById("downloadBtn").style.display="block";
}

function downloadQR(){
let img=document.querySelector("#qrcode img");
let link=document.createElement("a");
link.href=img.src;
link.download="MyQR.png";
link.click();
}
</script>

</body>
</html>
